<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>디지몬마스터즈 컨텐츠 도우미</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #e2e8f0;
            color: #1e293b;
            transition: background-color 0.3s ease;
        }
        .emphasized-char {
            color: #f97316; /* 오렌지색으로 강조 */
            font-weight: bold;
        }
        .firework {
            position: fixed;
            pointer-events: none;
            z-index: 1000;
            animation: explode 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
            opacity: 0;
        }
        @keyframes explode {
            0% {
                transform: translate(-50%, -50%) scale(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1.5) rotate(720deg);
                opacity: 0;
            }
        }
        .danbam-green {
            color: #2e7d32; /* 소주병 느낌의 진한 녹색 */
        }
        .disabled-item {
            background-color: #e5e7eb !important;
            color: #9ca3af !important;
            text-decoration: line-through;
        }
        .text-xxs {
            font-size: 0.65rem;
        }
        /* 추가된 더 작은 폰트 크기 */
        .text-xxxs {
            font-size: 0.5rem;
        }
        /* Modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 500px;
            animation: fadeIn 0.3s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        /* 모바일에서만 줄바꿈 적용 */
        @media (max-width: 639px) { /* sm breakpoint보다 작을 때 */
            .mobile-br {
                display: block;
            }
            /* 모바일에서만 제목 가운데 정렬 */
            .mobile-center-title {
                text-align: center;
                padding-right: 0 !important;
            }
            /* 모바일에서 버튼 폰트 크기 조정 */
            .mobile-no-wrap {
                white-space: nowrap;
            }
        }
        @media (min-width: 640px) { /* sm breakpoint 이상일 때 */
            .mobile-br {
                display: none;
            }
        }
    </style>
</head>
<body class="p-4 sm:p-8 bg-gray-100 min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-200 to-indigo-200">

    <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-2xl w-full max-w-4xl relative">
        <!-- 상단 레이아웃을 위한 새로운 컨테이너 -->
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6">
            <!-- 만든사람 저작권 표기 (좌측) -->
            <div class="text-xs text-gray-600 mb-2 sm:mb-0 whitespace-nowrap flex-shrink-0">
                Made by. <span class="font-extrabold text-blue-800">짠밤</span><span class="text-xxxs">, from <span class="font-bold danbam-green text-xxs">단밤</span> Guild</span>
            </div>
            
            <!-- 타이틀 (중앙 정렬) -->
            <h1 class="text-3xl font-bold text-blue-800 text-center flex-grow sm:pr-4 mobile-center-title">디지몬마스터즈<span class="mobile-br"></span> 컨텐츠 도우미</h1>

            <!-- 타이머 컨테이너 (우측) -->
            <div class="text-xs text-gray-600 mt-2 sm:mt-0 flex flex-col gap-1 flex-shrink-0">
                <!-- 타이머를 두 개의 요소로 분리하여 정렬 문제 해결 -->
                <div class="flex justify-between items-center w-full min-w-[120px]">
                    <span>일일 초기화:</span>
                    <span id="daily-timer" class="text-right"></span>
                </div>
                <div class="flex justify-between items-center w-full min-w-[120px]">
                    <span>주간 초기화:</span>
                    <span id="weekly-timer" class="text-right"></span>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- 일일 컨텐츠 목록 -->
            <div class="bg-gray-50 p-4 rounded-xl shadow-inner border border-gray-200 flex flex-col">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-gray-800">일일 컨텐츠 (<span id="daily-count">0/13</span>)</h2>
                    <button id="daily-disable-btn" onclick="openDisableModal('daily')" class="text-xs text-white bg-blue-500 hover:bg-blue-600 rounded-lg px-2 py-1 transition-colors duration-200 mobile-no-wrap">비활성 설정</button>
                </div>
                <ul id="daily-quest-list" class="flex flex-col flex-grow justify-between gap-3">
                    <!-- 퀘스트 아이템이 여기에 렌더링됩니다 -->
                </ul>
            </div>

            <!-- 주간 컨텐츠 목록 -->
            <div class="bg-gray-50 p-4 rounded-xl shadow-inner border border-gray-200 flex flex-col">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-gray-800">주간 컨텐츠 (<span id="weekly-count">0/13</span>)</h2>
                    <button id="weekly-disable-btn" onclick="openDisableModal('weekly')" class="text-xs text-white bg-blue-500 hover:bg-blue-600 rounded-lg px-2 py-1 transition-colors duration-200 mobile-no-wrap">비활성 설정</button>
                </div>
                <ul id="weekly-quest-list" class="flex flex-col flex-grow gap-3">
                    <!-- 퀘스트 아이템이 여기에 렌더링됩니다 -->
                </ul>
            </div>
        </div>

        <!-- Modal for disabling quests -->
        <div id="disable-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="modal-title" class="text-xl font-bold text-gray-800">컨텐츠 비활성 설정</h3>
                    <button onclick="closeDisableModal()" class="text-gray-500 hover:text-gray-700 text-2xl font-bold">&times;</button>
                </div>
                <div id="modal-list" class="space-y-2">
                    <!-- Checkbox list will be rendered here -->
                </div>
                <button onclick="closeDisableModal()" class="mt-6 w-full py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors duration-200">닫기</button>
            </div>
        </div>

    </div>

    <script>
        // Fixed quest content lists
        const hardcodedQuests = {
            daily: [
                { id: 'daily-1', name: '할배몬의 럭키 박스', completed: false, disabled: false, emphasizedParts: [] },
                { id: 'daily-2', name: '일일 출석', completed: false, disabled: false, emphasizedParts: [] },
                { id: 'daily-4', name: '이벤트 출석 (06시 초기화)', completed: false, disabled: false, emphasizedParts: [] },
                { id: 'daily-3', name: '접속시간 보상', completed: false, disabled: false, emphasizedParts: [] },
                { id: 'daily-5', name: '간쿠몬의 수련장', completed: false, disabled: false, emphasizedParts: [] },
                { id: 'daily-6', name: '시즌패스 퀘스트 - 일일', completed: false, disabled: false, emphasizedParts: [] },
                { id: 'daily-7', name: 'EP 퀘스트', completed: false, disabled: false, emphasizedParts: [] },
                { id: 'daily-8', name: 'T 디지털 드로우', completed: false, disabled: false, emphasizedParts: [] },
                { id: 'daily-9', name: '서버대륙 사막 - 이속칩', completed: false, disabled: false, emphasizedParts: [] },
                { id: 'daily-10', name: '요일 던전 - 그림자 미궁', completed: false, disabled: false, emphasizedParts: [] },
                { id: 'daily-11', name: '카이저의 영역 레이드(카영레) 티켓', completed: false, disabled: false, emphasizedParts: ['카영레'] },
                { id: 'daily-12', name: '로얄베이스 어려움(로어) - 일일', completed: false, disabled: false, emphasizedParts: ['로어'] },
                { id: 'daily-13', name: '파괴와 재생 (스던) - 일일', completed: false, disabled: false, emphasizedParts: ['스던'] },
            ],
            weekly: [
                { id: 'weekly-1', name: '시즌패스 퀘스트 - 주간', completed: false, disabled: false, emphasizedParts: [] },
                { id: 'weekly-2', name: '디지몬 아레나', completed: false, disabled: false, emphasizedParts: [] },
                { id: 'weekly-3', name: '참치캔 던전', completed: false, disabled: false, emphasizedParts: [] },
                { id: 'weekly-4', name: '로얄베이스 HARD (로어) - 주간', completed: false, disabled: false, emphasizedParts: ['로어'] },
                { id: 'weekly-5', name: '파괴와 재생 (스던) - 주간', completed: false, disabled: false, emphasizedParts: ['스던'] },
                { id: 'weekly-6', name: '디지몬 카이저 (메청)', completed: false, disabled: false, emphasizedParts: ['메청'] },
                { id: 'weekly-7', name: '카이저의 기지 EASY (키이)', completed: false, disabled: false, emphasizedParts: ['키이'] },
                { id: 'weekly-8', name: '카이저의 기지 NORMAL (키노)', completed: false, disabled: false, emphasizedParts: ['키노'] },
                { id: 'weekly-9', name: '상점가 EASY (상이지)', completed: false, disabled: false, emphasizedParts: ['상이지'] },
                { id: 'weekly-10', name: '상점가 NORMAL (상노)', completed: false, disabled: false, emphasizedParts: ['상노'] },
                { id: 'weekly-11', name: '사성수 던전 NORMAL ~ HARD', completed: false, disabled: false, emphasizedParts: ['사성수'] },
                { id: 'weekly-12', name: '황룡몬 던전 NORMAL ~ HARD (판노 ~ 판어)', completed: false, disabled: false, emphasizedParts: ['판노', '판어'] },
                { id: 'weekly-13', name: '다크웹', completed: false, disabled: false, emphasizedParts: ['다크웹'] },
            ]
        };

        let quests = {};
        let currentModalType = '';

        // Function to save data to local storage
        const saveQuests = () => {
            localStorage.setItem('digimonQuests', JSON.stringify(quests));
        };

        // Function to load data from local storage
        const loadQuests = () => {
            const stored = localStorage.getItem('digimonQuests');
            return stored ? JSON.parse(stored) : null;
        };
        
        // Function to reset only completion status
        const resetQuests = (type) => {
            if (quests[type]) {
                quests[type] = quests[type].map(q => ({ ...q, completed: false }));
            }
        };

        // Automatic reset logic
        const handleAutoReset = () => {
            const now = new Date();
            const lastDailyReset = new Date(localStorage.getItem('lastDailyReset') || 0);
            const lastWeeklyReset = new Date(localStorage.getItem('lastWeeklyReset') || 0);
            
            // Daily reset (at 00:00)
            const isDifferentDay = now.getDate() !== lastDailyReset.getDate() ||
                                   now.getMonth() !== lastDailyReset.getMonth() ||
                                   now.getFullYear() !== lastDailyReset.getFullYear();
            if (isDifferentDay) {
                // Reset only completed status
                quests.daily.forEach(q => {
                    q.completed = false;
                });
                localStorage.setItem('lastDailyReset', now.toISOString());
            }

            // Weekly reset (Wednesday at 06:00)
            const dayOfWeek = now.getDay();
            let daysUntilNextWednesday = (3 - dayOfWeek + 7) % 7;
            if (daysUntilNextWednesday === 0 && now.getHours() >= 6) {
                daysUntilNextWednesday = 7;
            }
            
            const nextWeeklyReset = new Date(now);
            nextWeeklyReset.setDate(now.getDate() + daysUntilNextWednesday);
            nextWeeklyReset.setHours(6, 0, 0, 0);
            const weeklyTimeDiff = nextWeeklyReset - now;

            if (lastWeeklyReset < nextWeeklyReset && now > nextWeeklyReset) {
                // Reset only completed status for weekly quests
                resetQuests('weekly');
                localStorage.setItem('lastWeeklyReset', now.toISOString());
            }
        };

        // Timer update function
        const updateTimers = () => {
            const now = new Date();
            
            // Daily timer calculation
            const nextDailyReset = new Date(now);
            nextDailyReset.setDate(now.getDate() + 1);
            nextDailyReset.setHours(0, 0, 0, 0);
            const dailyTimeDiff = nextDailyReset - now;
            
            const dailyHours = Math.floor((dailyTimeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const dailyMinutes = Math.floor((dailyTimeDiff % (1000 * 60 * 60)) / (1000 * 60));
            const dailySeconds = Math.floor((dailyTimeDiff % (1000 * 60)) / 1000);
            
            // Update only the time span
            document.getElementById('daily-timer').textContent = `${String(dailyHours).padStart(2, '0')}:${String(dailyMinutes).padStart(2, '0')}:${String(dailySeconds).padStart(2, '0')}`;

            // Weekly timer calculation (Wednesday at 06:00)
            const dayOfWeek = now.getDay();
            let daysUntilNextWednesday = (3 - dayOfWeek + 7) % 7;
            if (daysUntilNextWednesday === 0 && now.getHours() >= 6) {
                daysUntilNextWednesday = 7;
            }
            
            const nextWeeklyReset = new Date(now);
            nextWeeklyReset.setDate(now.getDate() + daysUntilNextWednesday);
            nextWeeklyReset.setHours(6, 0, 0, 0);
            const weeklyTimeDiff = nextWeeklyReset - now;

            // 주간 타이머를 시 단위로 합산하여 표시
            const totalWeeklyHours = Math.floor(weeklyTimeDiff / (1000 * 60 * 60));
            const weeklyMinutes = Math.floor((weeklyTimeDiff % (1000 * 60 * 60)) / (1000 * 60));
            const weeklySeconds = Math.floor((weeklyTimeDiff % (1000 * 60)) / 1000);
            
            document.getElementById('weekly-timer').textContent = `${String(totalWeeklyHours).padStart(2, '0')}:${String(weeklyMinutes).padStart(2, '0')}:${String(weeklySeconds).padStart(2, '0')}`;
        };

        // Function to celebrate with a more spectacular animation
        const celebrate = () => {
            const colors = ['#ff6b6b', '#ffd166', '#49a3e3', '#66cc99', '#ff99e6', '#c084fc', '#f472b6'];
            const numberOfParticles = 300;

            for (let i = 0; i < numberOfParticles; i++) {
                const particle = document.createElement('div');
                const randomSize = Math.floor(Math.random() * 8) + 5; // Size between 5px and 12px
                
                particle.className = 'firework';
                
                const angle = Math.random() * Math.PI * 2;
                const distance = Math.random() * Math.max(window.innerWidth, window.innerHeight) / 2;
                
                const x = window.innerWidth / 2 + Math.cos(angle) * distance;
                const y = window.innerHeight / 2 + Math.sin(angle) * distance;
                
                particle.style.width = `${randomSize}px`;
                particle.style.height = `${randomSize}px`;
                particle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                particle.style.left = `${x}px`;
                particle.style.top = `${y}px`;
                particle.style.animationDelay = `${Math.random() * 0.8}s`;

                document.body.appendChild(particle);

                setTimeout(() => {
                    particle.remove();
                }, 1500);
            }
        };

        // Function to set initial quest data
        const initializeQuests = () => {
            const storedQuests = loadQuests();
            if (storedQuests) {
                const newQuests = { daily: [], weekly: [] };
                
                hardcodedQuests.daily.forEach(q => {
                    const existing = storedQuests.daily.find(sq => sq.id === q.id);
                    newQuests.daily.push(existing ? { ...q, completed: existing.completed, disabled: existing.disabled } : q);
                });
                
                hardcodedQuests.weekly.forEach(q => {
                    const existing = storedQuests.weekly.find(sq => sq.id === q.id);
                    newQuests.weekly.push(existing ? { ...q, completed: existing.completed, disabled: existing.disabled } : q);
                });

                quests = newQuests;
            } else {
                quests = JSON.parse(JSON.stringify(hardcodedQuests));
            }
            
            handleAutoReset();
            renderQuests();
        };

        // Function to render quests and update counters
        const renderQuests = () => {
            const dailyList = document.getElementById('daily-quest-list');
            const weeklyList = document.getElementById('weekly-quest-list');
            const dailyCount = document.getElementById('daily-count');
            const weeklyCount = document.getElementById('weekly-count');

            dailyList.innerHTML = '';
            weeklyList.innerHTML = '';

            quests.daily.forEach(quest => dailyList.appendChild(createQuestItem(quest, 'daily')));
            quests.weekly.forEach(quest => weeklyList.appendChild(createQuestItem(quest, 'weekly')));
            
            // Update counters based on non-disabled quests
            const dailyActiveQuests = quests.daily.filter(q => !q.disabled);
            const dailyCompleted = dailyActiveQuests.filter(q => q.completed).length;
            
            const weeklyActiveQuests = quests.weekly.filter(q => !q.disabled);
            const weeklyCompleted = weeklyActiveQuests.filter(q => q.completed).length;

            dailyCount.textContent = `${dailyCompleted}/${dailyActiveQuests.length}`;
            weeklyCount.textContent = `${weeklyCompleted}/${weeklyActiveQuests.length}`;
            
            saveQuests();
        };

        // Function to create quest item HTML element
        const createQuestItem = (quest, type) => {
            const li = document.createElement('li');
            li.className = `flex items-center p-3 rounded-lg shadow-sm transition-all duration-200`;
            
            // Add click event for completion toggle
            li.onclick = () => toggleCompletion(quest.id, type);

            // Add classes for styling
            li.classList.add(quest.completed ? 'bg-green-200' : 'bg-white');
            li.classList.add(quest.completed ? 'text-gray-700' : 'hover:bg-gray-100');
            if (quest.disabled) {
                li.classList.add('disabled-item');
                li.onclick = null; // Disable the click event
            } else {
                li.classList.add('cursor-pointer');
            }

            const nameSpan = document.createElement('span');
            nameSpan.className = `flex-grow`;
            
            // Removed specific font size for 'weekly-12' quest to make all items uniform.
            
            const parts = renderQuestNameWithEmphasis(quest.name, quest.emphasizedParts);
            parts.forEach(p => nameSpan.appendChild(p));
            
            li.appendChild(nameSpan);

            // Completion checkmark
            if (quest.completed) {
                const checkmarkSpan = document.createElement('span');
                checkmarkSpan.textContent = '✓';
                checkmarkSpan.className = 'ml-auto text-xl text-green-600 font-bold';
                li.appendChild(checkmarkSpan);
            }

            return li;
        };

        // Function to apply emphasis to quest names
        const renderQuestNameWithEmphasis = (name, emphasizedParts) => {
            const elements = [];
            let currentText = name;

            emphasizedParts.forEach(part => {
                const index = currentText.indexOf(part);
                if (index !== -1) {
                    const textBefore = currentText.substring(0, index);
                    const emphasizedPart = currentText.substring(index, index + part.length);
                    currentText = currentText.substring(index + part.length);

                    if (textBefore) {
                        elements.push(document.createTextNode(textBefore));
                    }
                    const span = document.createElement('span');
                    span.textContent = emphasizedPart;
                    span.className = 'emphasized-char';
                    elements.push(span);
                }
            });

            if (currentText) {
                elements.push(document.createTextNode(currentText));
            }
            return elements;
        };

        // Function to toggle quest completion status
        const toggleCompletion = (id, type) => {
            const questToToggle = quests[type].find(q => q.id === id);
            if (questToToggle) {
                questToToggle.completed = !questToToggle.completed;
                
                // Check if all active quests are now completed
                const activeQuests = quests[type].filter(q => !q.disabled);
                const completedActiveQuests = activeQuests.filter(q => q.completed).length;
                if (activeQuests.length > 0 && completedActiveQuests === activeQuests.length) {
                    celebrate();
                }

                renderQuests();
            }
        };

        // Function to open the disable modal
        const openDisableModal = (type) => {
            currentModalType = type;
            const modal = document.getElementById('disable-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalList = document.getElementById('modal-list');

            modalTitle.textContent = `${type === 'daily' ? '일일' : '주간'} 컨텐츠 비활성 설정`;
            modalList.innerHTML = '';
            
            quests[type].forEach(quest => {
                const item = document.createElement('div');
                item.className = 'flex items-center';
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = quest.disabled;
                checkbox.id = `disable-${quest.id}`;
                checkbox.className = 'mr-2 h-4 w-4 text-blue-600 rounded focus:ring-blue-500 cursor-pointer';

                const label = document.createElement('label');
                label.htmlFor = `disable-${quest.id}`;
                label.textContent = quest.name;
                label.className = 'flex-grow text-sm cursor-pointer';

                checkbox.onchange = () => toggleDisable(quest.id, type);

                item.appendChild(checkbox);
                item.appendChild(label);
                modalList.appendChild(item);
            });

            modal.classList.remove('hidden');
        };
        
        // Function to close the disable modal
        const closeDisableModal = () => {
            document.getElementById('disable-modal').classList.add('hidden');
        };

        // Function to toggle disable status from the modal
        const toggleDisable = (id, type) => {
            const questToToggle = quests[type].find(q => q.id === id);
            if (questToToggle) {
                questToToggle.disabled = !questToToggle.disabled;
                if (questToToggle.disabled) {
                    questToToggle.completed = false;
                }
                renderQuests();
            }
        };

        // On page load, load quests and start the timers
        window.onload = () => {
            initializeQuests();
            setInterval(updateTimers, 1000); // Update the timers every second
        };
    </script>
</body>
</html>
