<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>디지몬마스터즈 컨텐츠 도우미</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        *, ::before, ::after { box-sizing: border-box; }
        html, body { height: 100%; margin: 0; }
        body {
            font-family: 'Inter', sans-serif;
            background: #f7f0e8; 
            color: #1e293b;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        .gucci-gradient-bg {
            padding: 1rem 1.5rem; 
            width: 95%; 
            max-width: 1200px; 
            height: 95vh; 
            max-height: 900px; 
            display: flex;
            flex-direction: column; 
        }
        .gucci-web-stripe-decorator {
            height: 3px; 
            background: linear-gradient(to right, #1a472a 0%, #1a472a 33%, #b33939 33%, #b33939 66%, #1a472a 66%, #1a472a 100%);
            width: 100%;
            margin: 0.5rem 0; 
        }
        .separator-bottom { margin-bottom: 0.5rem; }
        .main-title { font-size: 1.5rem; line-height: 1; margin: 0; }
        .main-title-wrapper {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            text-align: center; 
            z-index: 10; 
        }
        .header-layout {
            line-height: 1.1;
            margin-bottom: 0.5rem; 
            display: flex; 
            justify-content: space-between;
            align-items: center;
            position: relative;
        }
        .creator-info-area { min-width: 90px; font-size: 0.8rem; flex-shrink: 0; }
        .timer-area { min-width: 135px; font-size: 0.7rem; flex-shrink: 0; }
        .timer-row { display: grid; grid-template-columns: 70px 55px; gap: 4px; align-items: center; }
        .timer-row > span:first-child { text-align: right; }
        .timer-row > span:last-child { text-align: right; }
        .quest-content-area { flex-grow: 1; overflow-y: hidden; display: flex; gap: 1.5rem; min-height: 0; }
        .quest-list-panel { flex-basis: 100%; display: flex; flex-direction: column; min-height: 0; }
        .quest-list-wrapper { flex-grow: 1; overflow-y: auto; padding-right: 0.5rem; margin-right: -0.5rem; min-height: 0; -webkit-overflow-scrolling: touch; }
        #daily-quest-list, #weekly-quest-list { gap: 0.5rem; padding-bottom: 0.5rem; }
        .quest-list-panel h2 { font-size: 1.5rem; margin-bottom: 0.5rem; }
        .quest-item { cursor: pointer; }
        .gucci-primary-text { color: #1a472a; }
        .gucci-secondary-text { color: #b33939; }
        .gucci-highlight-text { color: #c88a38; font-weight: bold; }
        .emphasized-char { color: #c88a38; font-weight: bold; }
        .gucci-button { background-color: #b33939; color: white; transition: background-color 0.2s ease; }
        .gucci-button:hover { background-color: #8c2b2b; }
        .gucci-checkbox:checked { background-color: #1a472a; border-color: #1a472a; }
        .disabled-item { background-color: #ececec !important; color: #9ca3af !important; text-decoration: line-through; }
        .no-wrap { white-space: nowrap; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); display: flex; justify-content: center; align-items: center; z-index: 100; }
        .modal-content { background-color: #fcf8f3; padding: 2rem; border-radius: 1rem; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2); width: 90%; max-width: 500px; max-height: 80vh; overflow-y: auto; }
        #celebration-popup { animation: popupIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes popupIn {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.1); }
            70% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
            100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }
        .confetti-particle { position: fixed; z-index: 102; pointer-events: none; }
        .confetti-diamond { transform: rotate(45deg); }
        @keyframes confettiFall {
            0% { transform: translateY(-50vh) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        @media (min-width: 768px) {
            .main-title { font-size: 2rem; }
            .quest-list-panel { flex-basis: 50%; }
        }
        @media (max-width: 767px) {
            .quest-content-area { flex-direction: column; gap: 1rem; }
            .quest-list-panel { height: 50%; }
        }
    </style>
</head>
<body>
    <div class="gucci-gradient-bg rounded-2xl relative">
        <div class="gucci-web-stripe-decorator"></div> 
        <div class="header-layout">
            <div class="creator-info-area text-gray-600 flex-col">
                <span class="text-sm">Made by. <span class="font-extrabold gucci-highlight-text">망근</span></span><br>
                <span class="text-xs text-gray-500">from <span class="font-bold gucci-primary-text">GUCCI</span> Guild</span>
            </div>
            <div class="main-title-wrapper">
                <h1 class="main-title font-bold gucci-primary-text">디지몬마스터즈 도우미</h1>
            </div>
            <div class="timer-area">
                <div class="timer-row"><span>일일 초기화:</span><span id="daily-timer" class="gucci-secondary-text font-semibold no-wrap"></span></div>
                <div class="timer-row"><span>주간 초기화:</span><span id="weekly-timer" class="gucci-secondary-text font-semibold no-wrap"></span></div>
            </div>
        </div>
        <div class="gucci-web-stripe-decorator separator-bottom"></div> 
        <div class="quest-content-area">
            <div class="bg-gray-50 p-4 rounded-xl shadow-inner border border-gray-200 quest-list-panel">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="font-bold gucci-primary-text">일일 컨텐츠 (<span id="daily-count">0/0</span>)</h2>
                    <button onclick="openDisableModal('daily')" class="text-xs gucci-button rounded-lg px-2 py-1">비활성 설정</button>
                </div>
                <div id="daily-list-wrapper" class="quest-list-wrapper">
                    <ul id="daily-quest-list" class="flex flex-col gap-0.5"></ul>
                </div>
            </div>
            <div class="bg-gray-50 p-4 rounded-xl shadow-inner border border-gray-200 quest-list-panel">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="font-bold gucci-primary-text">주간 컨텐츠 (<span id="weekly-count">0/0</span>)</h2>
                    <button onclick="openDisableModal('weekly')" class="text-xs gucci-button rounded-lg px-2 py-1">비활성 설정</button>
                </div>
                <div id="weekly-list-wrapper" class="quest-list-wrapper">
                    <ul id="weekly-quest-list" class="flex flex-col gap-0.5"></ul>
                </div>
            </div>
        </div>
        <div id="disable-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="modal-title" class="text-xl font-bold gucci-primary-text">설정</h3>
                    <button onclick="closeDisableModal()" class="text-2xl">&times;</button>
                </div>
                <div id="modal-list" class="space-y-2"></div>
                <button onclick="closeDisableModal()" class="mt-6 w-full py-2 gucci-button rounded-lg">닫기</button>
            </div>
        </div>
    </div>

    <script>
        const hardcodedQuests = {
            daily: [
                { id: 'daily-1', name: '할배몬의 럭키 박스', completed: false, disabled: false, emphasizedParts: [] },
                { id: 'daily-3', name: '접속시간 이벤트', completed: false, disabled: false, emphasizedParts: [] },
                { id: 'daily-2', name: '출석체크 이벤트', completed: false, disabled: false, emphasizedParts: [] },
                { id: 'daily-4', name: '일일 출석부 이벤트', completed: false, disabled: false, emphasizedParts: [] },
                { id: 'daily-5', name: '간쿠몬의 수련장', completed: false, disabled: false, emphasizedParts: [] },
                { id: 'daily-6', name: '시즌패스 퀘스트 - 일일', completed: false, disabled: false, emphasizedParts: [] },
                { id: 'daily-7', name: '겨울이벤트(재료 200개) - 일일', completed: false, disabled: false, emphasizedParts: ['겨울이벤트'] },
                { id: 'daily-frontier', name: '프론티어 퀘스트 - 일일', completed: false, disabled: false, emphasizedParts: ['프론티어'] },
                { id: 'daily-8', name: 'T 디지털 드로우', completed: false, disabled: false, emphasizedParts: [] },
                { id: 'daily-9', name: '서버대륙 사막 - 이속칩', completed: false, disabled: false, emphasizedParts: [] },
                { id: 'daily-10', name: '요일 던전 (요던) - 그림자 미궁', completed: false, disabled: false, emphasizedParts: ['요던'] },
                { id: 'daily-11', name: '카이저의 영역 레이드(카영레) 티켓', completed: false, disabled: false, emphasizedParts: ['카영레'] },
                { id: 'daily-12', name: '로얄베이스 어려움(로어) - 일일', completed: false, disabled: false, emphasizedParts: ['로어'] },
                { id: 'daily-13', name: '파괴와 재생 (스던) - 일일', completed: false, disabled: false, emphasizedParts: ['스던'] },
                { id: 'daily-14', name: '신규 U등급 지하소환소', completed: false, disabled: false, emphasizedParts: ['U등급'] }, 
            ],
            weekly: [
                { id: 'weekly-18', name: '디지몬 탐험', completed: false, disabled: false, emphasizedParts: [] },
                { id: 'weekly-1', name: '시즌패스 퀘스트 - 주간', completed: false, disabled: false, emphasizedParts: [] },
                { id: 'weekly-2', name: '디지몬 아레나', completed: false, disabled: false, emphasizedParts: [] },
                { id: 'weekly-3', name: '요코하마 비밀공원 (참치캔)', completed: false, disabled: false, emphasizedParts: ['참치캔'] },
                { id: 'weekly-3-2', name: '겨울이벤트(재료 200개) - 주간', completed: false, disabled: false, emphasizedParts: ['겨울이벤트'] },
                { id: 'weekly-frontier', name: '프론티어 퀘스트 - 주간', completed: false, disabled: false, emphasizedParts: ['프론티어'] },
                { id: 'weekly-4', name: '로얄베이스 HARD (로어) - 주간', completed: false, disabled: false, emphasizedParts: ['로어'] },
                { id: 'weekly-5', name: '파괴와 재생 (스던) - 주간', completed: false, disabled: false, emphasizedParts: ['스던'] },
                { id: 'weekly-6', name: '디지몬 카이저 (메청)', completed: false, disabled: false, emphasizedParts: ['메청'] },
                { id: 'weekly-7', name: '카이저의 기지 EASY (키이)', completed: false, disabled: false, emphasizedParts: ['키이'] },
                { id: 'weekly-8', name: '카이저의 기지 NORMAL (키노)', completed: false, disabled: false, emphasizedParts: ['키노'] },
                { id: 'weekly-9', name: '상점가 EASY (상이지)', completed: false, disabled: false, emphasizedParts: ['상이지'] },
                { id: 'weekly-10', name: '상점가 NORMAL (상노)', completed: false, disabled: false, emphasizedParts: ['상노'] },
                { id: 'weekly-11', name: '사성수 던전 NORMAL', completed: false, disabled: false, emphasizedParts: ['사성수'] },
                { id: 'weekly-12', name: '사성수 던전 HARD', completed: false, disabled: false, emphasizedParts: ['사성수'] },
                { id: 'weekly-13', name: '황룡몬 던전 NORMAL (판노)', completed: false, disabled: false, emphasizedParts: ['판노'] },
                { id: 'weekly-14', name: '황룡몬 던전 HARD (판어)', completed: false, disabled: false, emphasizedParts: ['판어'] },
                { id: 'weekly-15', name: '다크웹 NORMAL', completed: false, disabled: false, emphasizedParts: ['다크웹'] },
                { id: 'weekly-16', name: '네버랜드 NORMAL', completed: false, disabled: false, emphasizedParts: ['네버랜드'] },
                { id: 'weekly-19', name: '악몽 HARD', completed: false, disabled: false, emphasizedParts: ['악몽'] },
            ]
        };

        let quests = {};
        let dailyCelebrated = false;
        let weeklyCelebrated = false;

        const saveQuests = () => {
            localStorage.setItem('digimonQuests', JSON.stringify(quests));
            localStorage.setItem('dailyCelebrated', dailyCelebrated);
            localStorage.setItem('weeklyCelebrated', weeklyCelebrated);
        };

        const loadQuests = () => {
            const stored = localStorage.getItem('digimonQuests');
            return stored ? JSON.parse(stored) : null;
        };

        const resetQuests = (type) => {
            if (quests[type]) {
                quests[type] = quests[type].map(q => ({ ...q, completed: false }));
            }
            if (type === 'daily') dailyCelebrated = false;
            if (type === 'weekly') weeklyCelebrated = false;
        };

        const handleAutoReset = () => {
            const now = new Date();
            const lastDailyResetStr = localStorage.getItem('lastDailyReset');
            const lastWeeklyResetStr = localStorage.getItem('lastWeeklyReset');

            const dailyThreshold = new Date(now);
            dailyThreshold.setHours(0, 0, 0, 0);

            if (lastDailyResetStr) {
                const lastReset = new Date(lastDailyResetStr);
                if (lastReset < dailyThreshold) {
                    resetQuests('daily');
                    localStorage.setItem('lastDailyReset', now.toISOString());
                }
            } else {
                localStorage.setItem('lastDailyReset', now.toISOString());
            }

            const weeklyResetDay = 2;
            const weeklyResetHour = 12;
            let weeklyThreshold = new Date(now);
            let daysSinceTuesday = (now.getDay() - weeklyResetDay + 7) % 7;
            weeklyThreshold.setDate(now.getDate() - daysSinceTuesday);
            weeklyThreshold.setHours(weeklyResetHour, 0, 0, 0);

            if (now.getDay() === weeklyResetDay && now.getHours() < weeklyResetHour) {
                weeklyThreshold.setDate(weeklyThreshold.getDate() - 7);
            }

            if (lastWeeklyResetStr) {
                const lastReset = new Date(lastWeeklyResetStr);
                if (lastReset < weeklyThreshold) {
                    resetQuests('weekly');
                    localStorage.setItem('lastWeeklyReset', now.toISOString());
                }
            } else {
                localStorage.setItem('lastWeeklyReset', now.toISOString());
            }
        };

        const updateTimers = () => {
            const now = new Date();
            const nextDaily = new Date(now);
            nextDaily.setDate(now.getDate() + 1);
            nextDaily.setHours(0, 0, 0, 0);
            const dDiff = nextDaily - now;
            const dH = Math.floor(dDiff / 3600000);
            const dM = Math.floor((dDiff % 3600000) / 60000);
            const dS = Math.floor((dDiff % 60000) / 1000);
            document.getElementById('daily-timer').textContent = `${String(dH).padStart(2,'0')}:${String(dM).padStart(2,'0')}:${String(dS).padStart(2,'0')}`;

            const nextWeekly = new Date(now);
            let dUntil = (2 - now.getDay() + 7) % 7;
            if (dUntil === 0 && now.getHours() >= 12) dUntil = 7;
            nextWeekly.setDate(now.getDate() + dUntil);
            nextWeekly.setHours(12, 0, 0, 0);
            const wDiff = nextWeekly - now;
            const wH = Math.floor(wDiff / 3600000);
            const wM = Math.floor((wDiff % 3600000) / 60000);
            const wS = Math.floor((wDiff % 60000) / 1000);
            document.getElementById('weekly-timer').textContent = `${String(wH).padStart(2,'0')}:${String(wM).padStart(2,'0')}:${String(wS).padStart(2,'0')}`;
        };

        const celebrate = (msg) => {
            const popup = document.createElement('div');
            popup.id = 'celebration-popup';
            popup.textContent = msg;
            popup.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-[101] bg-white border-4 border-yellow-500 text-2xl font-bold px-8 py-4 rounded-full shadow-2xl';
            document.body.appendChild(popup);
            
            for(let i=0; i<100; i++) {
                const p = document.createElement('div');
                p.className = 'confetti-particle';
                p.style.backgroundColor = ['#FFD700','#FF6347','#ADFF2F','#1E90FF','#FFA07A'][Math.floor(Math.random()*5)];
                p.style.width = p.style.height = Math.random()*10+5+'px';
                p.style.left = Math.random()*100+'vw';
                p.style.top = '-10px';
                p.style.animation = `confettiFall ${Math.random()*2+1}s forwards`;
                document.body.appendChild(p);
                setTimeout(()=>p.remove(), 3000);
            }
            setTimeout(() => popup.remove(), 2000);
        };

        const initializeQuests = () => {
            const stored = loadQuests();
            if (stored) {
                quests = { daily: [], weekly: [] };
                hardcodedQuests.daily.forEach(q => {
                    const ex = stored.daily.find(s => s.id === q.id);
                    quests.daily.push(ex ? { ...q, completed: ex.completed, disabled: ex.disabled } : q);
                });
                hardcodedQuests.weekly.forEach(q => {
                    const ex = stored.weekly.find(s => s.id === q.id);
                    quests.weekly.push(ex ? { ...q, completed: ex.completed, disabled: ex.disabled } : q);
                });
                dailyCelebrated = localStorage.getItem('dailyCelebrated') === 'true';
                weeklyCelebrated = localStorage.getItem('weeklyCelebrated') === 'true';
            } else {
                quests = JSON.parse(JSON.stringify(hardcodedQuests));
            }
            handleAutoReset();
            renderQuests(false);
        };

        const renderQuests = (doCelebrate = true) => {
            const dList = document.getElementById('daily-quest-list');
            const wList = document.getElementById('weekly-quest-list');
            dList.innerHTML = ''; wList.innerHTML = '';

            const dActive = quests.daily.filter(q => !q.disabled);
            const wActive = quests.weekly.filter(q => !q.disabled);

            dActive.forEach(q => dList.appendChild(createItem(q, 'daily')));
            wActive.forEach(q => wList.appendChild(createItem(q, 'weekly')));

            const dComp = dActive.filter(q => q.completed).length;
            const wComp = wActive.filter(q => q.completed).length;

            document.getElementById('daily-count').textContent = `${dComp}/${dActive.length}`;
            document.getElementById('weekly-count').textContent = `${wComp}/${wActive.length}`;

            if (doCelebrate) {
                if (dActive.length > 0 && dComp === dActive.length && !dailyCelebrated) {
                    celebrate('오늘의 컨텐츠 완료!'); dailyCelebrated = true;
                } else if (dComp < dActive.length) dailyCelebrated = false;

                if (wActive.length > 0 && wComp === wActive.length && !weeklyCelebrated) {
                    celebrate('주간 컨텐츠 완료!'); weeklyCelebrated = true;
                } else if (wComp < wActive.length) weeklyCelebrated = false;
            }
            saveQuests();
        };

        const createItem = (q, type) => {
            const li = document.createElement('li');
            li.className = `flex items-center p-2 rounded-lg shadow-sm transition-all ${q.completed ? 'bg-green-100' : 'bg-white hover:bg-gray-100'} quest-item`;
            li.onclick = () => {
                q.completed = !q.completed;
                renderQuests(true);
            };
            
            const span = document.createElement('span');
            span.className = 'flex-grow text-sm sm:text-base';
            
            let name = q.name;
            q.emphasizedParts.forEach(p => {
                const regex = new RegExp(p, "g");
                name = name.replace(regex, `<span class="emphasized-char">${p}</span>`);
            });
            span.innerHTML = name;
            
            const check = document.createElement('span');
            check.textContent = '✓';
            check.className = `ml-auto gucci-highlight-text font-bold transition-opacity ${q.completed ? 'opacity-100' : 'opacity-0'}`;
            
            li.appendChild(span); li.appendChild(check);
            return li;
        };

        const openDisableModal = (type) => {
            const m = document.getElementById('disable-modal');
            const list = document.getElementById('modal-list');
            list.innerHTML = '';
            quests[type].forEach(q => {
                const div = document.createElement('div');
                div.className = 'flex items-center gap-2';
                const cb = document.createElement('input');
                cb.type = 'checkbox'; cb.checked = q.disabled;
                cb.onchange = () => { q.disabled = cb.checked; if(q.disabled) q.completed = false; renderQuests(false); };
                const lb = document.createElement('label'); lb.textContent = q.name;
                div.appendChild(cb); div.appendChild(lb);
                list.appendChild(div);
            });
            m.classList.remove('hidden');
        };

        const closeDisableModal = () => document.getElementById('disable-modal').classList.add('hidden');

        window.onload = () => {
            initializeQuests();
            setInterval(updateTimers, 1000);
        };
    </script>
</body>
</html>
